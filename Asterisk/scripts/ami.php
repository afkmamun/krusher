<?php
//HTTP headers
Header("Content-Type: text/html;charset=UTF-8");
header('Access-Control-Allow-Origin: *');
// SETTINGS
        $server     = "localhost";
        $port       = "5038";
        $username   = "wc";
        $secret     = "*****";
        $step       = "500";
        $step2      = "1000";
        $timeout    = "100";
        //GET INCOMING VAR
        $from       = $_GET['from'];
        $to         = $_GET['to'];
        $clinum     = $_GET['to'];
        $name       = $_GET['name'];
        $type       = $_GET['type'];
        $accountcode= $_GET['accountcode'];
        $sleep      = $_GET['sleep'];
        $lead       = $_GET['lead'];
        $mk         = $_GET['mk'];
        $contact    = $_GET['contact'];
        $skill_group= $_GET['skill_group'];
        $added_by   = $_GET['added_by'];
if(empty($to))  exit("EMPTY to");
if(empty($from))exit("EMPTY from");
if(empty($type))exit("EMPTY type");

if($sleep) { echo $sleep; sleep($sleep);}

if( $type == "2" )
{
        $from   = $_GET['to'];
        $to     = $_GET['from'];
}

if(empty($_GET['help']))  {

// CONNECT TO ASTERISK AMI
        $socket = fsockopen($server,$port, $errno, $errstr, $timeout);
        usleep($step);
        fputs($socket, "Action: Login\r\n");
        fputs($socket, "UserName: $username\r\n");
        fputs($socket, "Secret: $secret\r\n\r\n");

        echo "$to\r\n";
        usleep($step);

// ORIGINATE CALL
        fputs($socket, "Action: Originate\r\n");

        //FIRST LEG
        fputs($socket, "Channel: Local/". $to ."@from-internal/n \r\n");
        fputs($socket, "Callerid: " . $name . " (".$accountcode.") <". $clinum .">\r\n");

        //SECOND LEG
        fputs($socket, "Exten: " . $from . "\r\n");
        fputs($socket, "Context: from-internal\r\n");
        fputs($socket, "Account: " . $accountcode . "\r\n");
        fputs($socket, "Priority: 1\r\n");
                //VAR
                fputs($socket, "__SIPADDHEADER60=X-Your-Header: header-val\r\n");
                fputs($socket, "_SIPADDHEADER61=X-Your-Header2: 11header-val\r\n");
                fputs($socket, "SIPADDHEADER62=X-Your-Header3: 11header-val\r\n");
                fputs($socket, "Variable: lead=" . $lead . "\r\n");
                fputs($socket, "Variable: mk=" . $mk . "\r\n");
                fputs($socket, "Variable: contact=" . $contact . "\r\n");
                fputs($socket, "Variable: added_by=" . $added_by . "\r\n");
                fputs($socket, "Variable: skill_group=" . $skill_group . "\r\n\r\n");
fputs($socket, "Action: Logoff\r\n");
sleep(5);
fclose($socket);
exit();
}

if(isset($_GET['help']))  {
echo "        ???????? ??????????";
echo "        <br/>";
echo "        <br/>";
echo "        $from       - ?????? ????? ??????? , ? ???????: 0978442044<br/>";
echo "        $to         - ?????????? ???? ?????????? ??????? ???? ?? ???????, ? ???????: 1000 , 1000 ? ?????? ?????? ????? ???????<br/>";
echo "        $clinum     - ????? ????????? ??????? ????? ???????? ?? ???????? ? ????????? , ? ???????: 0978442044<br/>";
echo "        $name       - ??? ????????? ??????? ????? ???????? ?? ???????? ? ????????? , ? ???????: Dima<br/>";
echo "        $type       - ?????????? ???? ???????? ??????? ?????????(???????) ??? ???????, ? ???????: 1 , ???????? ????? ???? 1 - ??????, 2- ???????<br/>";
echo "        $accountcode - ?????? ????? ??????? ??? ????????, ? ??????? :  site1 <br/>";
}
?>